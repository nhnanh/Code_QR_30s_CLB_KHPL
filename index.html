<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG ƒêI·ªÇM DANH QR</title>
    <!-- Th∆∞ vi·ªán t·∫°o QR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #1e293b; --danger: #ef4444; --marquee-bg: #ea580c; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        /* N√∫t C√†i ƒë·∫∑t */
        .settings-btn { position: absolute; top: 20px; left: 20px; font-size: 28px; color: #64748b; cursor: pointer; padding: 10px; z-index: 100; transition: 0.3s; }
        .settings-btn:hover { color: var(--primary); transform: rotate(90deg); }

        /* Khung ch·ª©a QR */
        .qr-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 380px; position: relative; z-index: 10; margin-bottom: 40px; }
        #qrcode { background: white; padding: 15px; border: 2px dashed #cbd5e1; border-radius: 16px; display: inline-block; margin: 20px 0; }
        
        .timer { font-size: 64px; font-weight: 900; color: var(--danger); line-height: 1; }
        .realtime { margin-top: 20px; font-weight: 600; color: #64748b; border-top: 1px solid #eee; padding-top: 15px;}

        /* D√≤ng ch·ªØ ch·∫°y */
        .marquee-container {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--marquee-bg); color: white;
            padding: 12px 0; font-weight: bold; font-size: 18px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            z-index: 5;
        }

        /* Modal Admin */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; border-radius: 20px; padding: 30px; max-height: 90vh; overflow-y: auto; text-align: left; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #333; }
        input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; color: white; transition: 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-save { background: var(--primary); }
        .btn-sheet { background: #10b981; } 
        .btn-clear { background: var(--danger); }
        .btn-close { background: #64748b; }
        
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <!-- N√∫t M·ªü C√†i ƒê·∫∑t -->
    <div class="settings-btn" onclick="checkLogin()" title="C√†i ƒë·∫∑t Admin"><i class="fa-solid fa-gear"></i></div>

    <!-- Giao di·ªán Ch√≠nh -->
    <div class="qr-card">
        <h1 id="orgName">ƒêI·ªÇM DANH CLB</h1>
        <div id="qrcode"></div>
        
        <div class="timer" id="countdown">--</div>
        <div style="font-size:14px; color:#64748b;">L√†m m·ªõi sau (gi√¢y)</div>
        
        <div class="realtime"><i class="fa-regular fa-clock"></i> <span id="clock">Loading...</span></div>
    </div>

    <!-- D√≤ng ch·ªØ ch·∫°y -->
    <div class="marquee-container">
        <marquee id="marqueeText" direction="left">üì¢ H·ªÜ TH·ªêNG ƒêANG M·ªû ƒêI·ªÇM DANH - VUI L√íNG QU√âT M√É NHANH CH√ìNG!</marquee>
    </div>

    <!-- MODAL ADMIN -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px; color:#333">‚öôÔ∏è Qu·∫£n Tr·ªã H·ªá Th·ªëng</h2>
            
            <div class="form-group">
                <label>Link trang Form (form.html):</label>
                <input type="text" id="cfgLink">
            </div>
            
            <div class="form-group">
                <label>N·ªôi dung ch·ªØ ch·∫°y (Marquee):</label>
                <input type="text" id="cfgMarquee" placeholder="Nh·∫≠p th√¥ng b√°o...">
            </div>

            <div class="form-group">
                <label>Link Google Sheet (Qu·∫£n l√Ω):</label>
                <input type="text" id="cfgSheet" placeholder="D√°n link sheet v√†o ƒë√¢y ƒë·ªÉ m·ªü nhanh...">
            </div>

            <div class="feature-grid" style="margin-top:0; margin-bottom:15px">
                <div>
                    <label>Th·ªùi gian ƒë·ªïi (s):</label>
                    <input type="number" id="cfgTime" value="30">
                </div>
                <div>
                    <label>M·∫≠t kh·∫©u Admin:</label>
                    <input type="text" id="cfgPass" value="Admin">
                </div>
            </div>

            <div class="feature-grid">
                <button class="btn btn-sheet" onclick="openSheet()"><i class="fa-solid fa-table"></i> M·ªü Sheet DS</button>
                <button class="btn btn-clear" onclick="clearSheetData()"><i class="fa-solid fa-trash"></i> X√≥a d·ªØ li·ªáu c≈©</button>
            </div>

            <button class="btn btn-save" onclick="saveConfig()"><i class="fa-solid fa-floppy-disk"></i> L∆ØU C√ÄI ƒê·∫∂T</button>
            <button class="btn btn-close" onclick="closeModal()">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. C·∫§U H√åNH LI√äN K·∫æT (D√ÅN API C·ª¶A B·∫†N V√ÄO ƒê√ÇY)
        const API_URL = "https://script.google.com/macros/s/AKfycbw57FoZhAjou0nRXKUgTyA5CY63c-uSVbWWXMahxHXkRxzr2Jhoaon6kwv6AcqjvMvj/exec";
        // ==========================================

        const DEFAULT_LINK = "https://nhnanh.github.io/Code_QR_30s_CLB_KHPL/form.html";
        const DEFAULT_MARQUEE = "üì¢ H·ªÜ TH·ªêNG ƒêANG M·ªû ƒêI·ªÇM DANH - VUI L√íNG QU√âT M√É NHANH CH√ìNG!";

        let config = {
            link: localStorage.getItem('qr_link') || DEFAULT_LINK,
            sheet: localStorage.getItem('qr_sheet') || "",
            time: parseInt(localStorage.getItem('qr_time')) || 30,
            pass: localStorage.getItem('qr_pass') || "Admin",
            marquee: localStorage.getItem('qr_marquee') || DEFAULT_MARQUEE
        };

        let timer = config.time;
        let qrObj = null;
        let interval = null;

        // --- KH·ªûI CH·∫†Y ---
        window.onload = function() {
            // √Åp d·ª•ng n·ªôi dung ch·ªØ ch·∫°y
            document.getElementById("marqueeText").innerText = config.marquee;
            
            startSystem();
            setInterval(() => {
                document.getElementById("clock").innerText = new Date().toLocaleString("vi-VN");
            }, 1000);
        };

        function startSystem() {
            if (interval) clearInterval(interval);
            updateQR();
            timer = config.time;
            
            interval = setInterval(() => {
                timer--;
                document.getElementById("countdown").innerText = timer;
                if (timer <= 0) {
                    timer = config.time;
                    updateQR();
                }
            }, 1000);
        }

        function updateQR() {
            const qrDiv = document.getElementById("qrcode");
            // Token th·ªùi gian th·ª±c (ƒë·ªÉ form check h·∫°n 45s)
            const token = Date.now(); 
            const finalLink = `${config.link}?t=${token}`;

            if (qrObj === null) {
                qrDiv.innerHTML = "";
                qrObj = new QRCode(qrDiv, { text: finalLink, width: 250, height: 250 });
            } else {
                qrObj.clear();
                qrObj.makeCode(finalLink);
            }
        }

        // --- CH·ª®C NƒÇNG ADMIN ---
        function checkLogin() {
            const p = prompt("Nh·∫≠p m·∫≠t kh·∫©u Admin:");
            if(p === config.pass) openModal();
            else if(p !== null) alert("Sai m·∫≠t kh·∫©u!");
        }

        function openModal() {
            document.getElementById("adminModal").style.display = "flex";
            document.getElementById("cfgLink").value = config.link;
            document.getElementById("cfgSheet").value = config.sheet;
            document.getElementById("cfgTime").value = config.time;
            document.getElementById("cfgPass").value = config.pass;
            document.getElementById("cfgMarquee").value = config.marquee; // ƒêi·ªÅn ch·ªØ ch·∫°y hi·ªán t·∫°i v√†o √¥
        }

        function closeModal() { document.getElementById("adminModal").style.display = "none"; }
        
        function saveConfig() {
            config.link = document.getElementById("cfgLink").value;
            config.sheet = document.getElementById("cfgSheet").value;
            config.time = parseInt(document.getElementById("cfgTime").value);
            config.pass = document.getElementById("cfgPass").value;
            config.marquee = document.getElementById("cfgMarquee").value;
            
            localStorage.setItem('qr_link', config.link);
            localStorage.setItem('qr_sheet', config.sheet);
            localStorage.setItem('qr_time', config.time);
            localStorage.setItem('qr_pass', config.pass);
            localStorage.setItem('qr_marquee', config.marquee);
            
            // C·∫≠p nh·∫≠t giao di·ªán ngay l·∫≠p t·ª©c
            document.getElementById("marqueeText").innerText = config.marquee;

            alert("ƒê√£ l∆∞u c√†i ƒë·∫∑t!");
            closeModal();
            startSystem();
        }

        function openSheet() {
            if(config.sheet) window.open(config.sheet, '_blank');
            else alert("Vui l√≤ng nh·∫≠p Link Sheet v√†o √¥ b√™n tr√™n tr∆∞·ªõc!");
        }

        // --- CH·ª®C NƒÇNG X√ìA D·ªÆ LI·ªÜU C≈® ---
        function clearSheetData() {
            if(confirm("‚ö†Ô∏è C·∫¢NH B√ÅO: H√†nh ƒë·ªông n√†y s·∫Ω x√≥a to√†n b·ªô danh s√°ch ƒëi·ªÉm danh c≈© trong Sheet (gi·ªØ l·∫°i ti√™u ƒë·ªÅ).\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë·ªÉ b·∫Øt ƒë·∫ßu bu·ªïi m·ªõi kh√¥ng?")) {
                
                // G·ª≠i l·ªánh x√≥a l√™n Google Script
                fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'CLEAR_DATA' })
                }).then(() => {
                    alert("‚úÖ ƒê√£ g·ª≠i l·ªánh x√≥a! D·ªØ li·ªáu s·∫Ω bi·∫øn m·∫•t sau v√†i gi√¢y. Vui l√≤ng ki·ªÉm tra Sheet.");
                }).catch(() => {
                    alert("‚ùå L·ªói k·∫øt n·ªëi! Vui l√≤ng ki·ªÉm tra l·∫°i m·∫°ng.");
                });
            }
        }
    </script>
</body>
</html>
```

### H∆∞·ªõng d·∫´n d√πng t√≠nh nƒÉng ch·ªØ ch·∫°y:
1.  B·∫•m v√†o bi·ªÉu t∆∞·ª£ng **B√°nh rƒÉng** > Nh·∫≠p m·∫≠t kh·∫©u.
2.  T√¨m √¥ **"N·ªôi dung ch·ªØ ch·∫°y (Marquee)"**.
3.  Nh·∫≠p n·ªôi dung m·ªõi (V√≠ d·ª•: *"L∆∞u √Ω: Sinh vi√™n mang theo th·∫ª sinh vi√™n khi ƒëi h·ªçc"*).
4.  B·∫•m **L∆ØU C√ÄI ƒê·∫∂T**. D√≤ng ch·ªØ b√™n d∆∞·ªõi s·∫Ω ƒë·ªïi ngay l·∫≠p t·ª©c.
