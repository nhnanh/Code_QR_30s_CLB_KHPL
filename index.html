<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QU·∫¢N TR·ªä ƒêI·ªÇM DANH PRO MAX</title>
    
    <!-- Th∆∞ vi·ªán QR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Th∆∞ vi·ªán Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Th∆∞ vi·ªán Bi·ªÉu ƒë·ªì (Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --text: #1e293b;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --white: #ffffff;
            --border: #e2e8f0;
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        /* --- GIAO DI·ªÜN QR --- */
        .settings-btn { position: absolute; top: 20px; left: 20px; font-size: 28px; color: #94a3b8; cursor: pointer; padding: 10px; z-index: 100; transition: 0.3s; }
        .settings-btn:hover { color: var(--primary); transform: rotate(90deg); }

        .qr-card { background: var(--white); padding: 40px; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); text-align: center; width: 380px; position: relative; z-index: 10; border: 1px solid var(--border); }
        #qrcode { background: var(--white); padding: 15px; border: 2px dashed #cbd5e1; border-radius: 16px; display: inline-block; margin: 20px 0; transition: 0.3s; }
        .timer { font-size: 64px; font-weight: 900; color: var(--danger); line-height: 1; font-variant-numeric: tabular-nums; }
        .realtime { margin-top: 20px; font-weight: 600; color: #64748b; border-top: 1px solid var(--border); padding-top: 15px;}

        /* --- MODAL ADMIN --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--white); width: 95%; max-width: 1000px; border-radius: 16px; display: flex; flex-direction: column; max-height: 95vh; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; }
        
        .modal-header { padding: 15px 25px; background: var(--white); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 18px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .close-modal { font-size: 24px; cursor: pointer; color: #94a3b8; }
        .close-modal:hover { color: var(--danger); }

        .modal-body { padding: 20px; overflow-y: auto; background: #f1f5f9; flex: 1; display: flex; flex-direction: column; }

        /* --- TABS --- */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; background: white; padding: 5px; border-radius: 10px; border: 1px solid var(--border); width: fit-content; }
        .tab-btn { padding: 8px 16px; border: none; background: none; font-weight: 600; color: #64748b; cursor: pointer; border-radius: 6px; transition: 0.2s; font-size: 13px; }
        .tab-btn:hover { background: #f1f5f9; }
        .tab-btn.active { background: var(--primary); color: white; shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .tab-content { display: none; animation: fadeEffect 0.3s; flex: 1; }
        .tab-content.active { display: flex; flex-direction: column; }
        @keyframes fadeEffect { from {opacity: 0; transform: translateY(5px);} to {opacity: 1; transform: translateY(0);} }

        /* --- DASHBOARD & CHARTS --- */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); display: flex; align-items: center; gap: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .stat-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-info h4 { margin: 0; font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; }
        .stat-info p { margin: 5px 0 0 0; font-size: 24px; font-weight: 800; color: var(--text); }

        .charts-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; min-height: 300px; }
        .chart-box { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .chart-title { font-weight: 700; margin-bottom: 15px; font-size: 14px; color: #475569; display: flex; justify-content: space-between; }
        .chart-canvas-container { flex: 1; position: relative; min-height: 250px; }

        /* --- DATA TABLE --- */
        .excel-toolbar { background: white; padding: 10px; border-radius: 8px 8px 0 0; border: 1px solid var(--border); border-bottom: none; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .excel-table-container { flex: 1; overflow: auto; border: 1px solid var(--border); background: white; border-radius: 0 0 8px 8px; min-height: 300px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #f8fafc; padding: 12px; text-align: left; font-weight: 700; color: #475569; position: sticky; top: 0; z-index: 10; border-bottom: 2px solid var(--border); cursor: pointer; user-select: none; }
        th:hover { background: #e2e8f0; color: var(--primary); }
        th i { font-size: 10px; margin-left: 5px; opacity: 0.5; }
        td { padding: 10px 12px; border-bottom: 1px solid var(--border); color: #334155; }
        tr:hover td { background-color: #f0fdfa; }

        /* --- FORM ELEMENTS --- */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        .btn { padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; color: white; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; font-size: 13px; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: var(--primary); }
        .btn-danger { background: var(--danger); }
        .btn-gray { background: #64748b; }
        
        .loader { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: var(--primary); border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 50;}
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .charts-row { grid-template-columns: 1fr; }
            .excel-toolbar { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

    <div class="settings-btn" onclick="checkLogin()"><i class="fa-solid fa-sliders"></i></div>

    <!-- M√†n h√¨nh QR -->
    <div class="qr-card">
        <h1 id="orgName" style="color:var(--primary)">ƒêI·ªÇM DANH CLB</h1>
        <div id="qrcode"></div>
        <div class="timer" id="countdown">--</div>
        <div style="font-size:13px; color:#94a3b8; margin-top:5px;">Gi√¢y l√†m m·ªõi</div>
        <div class="realtime"><i class="fa-regular fa-clock"></i> <span id="clock">Loading...</span></div>
    </div>

    <!-- MODAL ADMIN -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fa-solid fa-shield-halved"></i> QU·∫¢N TR·ªä VI√äN</div>
                <div class="close-modal" onclick="closeModal()">&times;</div>
            </div>

            <div class="modal-body">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('tab-stats')"><i class="fa-solid fa-chart-pie"></i> Th·ªëng K√™ & Bi·ªÉu ƒê·ªì</button>
                    <button class="tab-btn" onclick="switchTab('tab-data')"><i class="fa-solid fa-table"></i> D·ªØ Li·ªáu Excel</button>
                    <button class="tab-btn" onclick="switchTab('tab-config')"><i class="fa-solid fa-gear"></i> C·∫•u H√¨nh</button>
                </div>

                <div id="loader" class="loader"></div>

                <!-- TAB 1: TH·ªêNG K√ä & BI·ªÇU ƒê·ªí -->
                <div id="tab-stats" class="tab-content active">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#dbeafe; color:var(--primary)"><i class="fa-solid fa-users"></i></div>
                            <div class="stat-info"><h4>T·ªïng Sinh Vi√™n</h4><p id="statTotal">0</p></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#dcfce7; color:var(--success)"><i class="fa-solid fa-layer-group"></i></div>
                            <div class="stat-info"><h4>S·ªë L·ªõp</h4><p id="statClasses">0</p></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#fee2e2; color:var(--danger)"><i class="fa-regular fa-clock"></i></div>
                            <div class="stat-info"><h4>M·ªõi nh·∫•t</h4><p id="statLatest" style="font-size:18px">--:--</p></div>
                        </div>
                    </div>

                    <div class="charts-row">
                        <!-- Bi·ªÉu ƒë·ªì C·ªôt: ƒêi·ªÉm danh theo gi·ªù -->
                        <div class="chart-box">
                            <div class="chart-title">
                                <span><i class="fa-solid fa-chart-column"></i> M·∫≠t ƒë·ªô ƒëi·ªÉm danh (Gi·ªù)</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="timeChart"></canvas>
                            </div>
                        </div>
                        <!-- Bi·ªÉu ƒë·ªì Tr√≤n: T·ª∑ l·ªá L·ªõp -->
                        <div class="chart-box">
                            <div class="chart-title">
                                <span><i class="fa-solid fa-chart-pie"></i> T·ª∑ l·ªá tham gia theo L·ªõp</span>
                            </div>
                            <div class="chart-canvas-container">
                                <canvas id="classChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: D·ªÆ LI·ªÜU EXCEL -->
                <div id="tab-data" class="tab-content">
                    <div class="excel-toolbar">
                        <div style="flex:1">
                            <input type="date" id="viewDate" onchange="fetchList()">
                        </div>
                        <div style="flex:2">
                            <input type="text" id="searchInput" placeholder="üîç L·ªçc nhanh (T√™n, MSSV, L·ªõp)..." onkeyup="applyFilter()">
                        </div>
                        <button class="btn btn-primary" onclick="fetchList()"><i class="fa-solid fa-rotate"></i> T·∫£i l·∫°i</button>
                    </div>

                    <div class="excel-table-container">
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('time')">Gi·ªù <i class="fa-solid fa-sort"></i></th>
                                    <th onclick="sortTable('name')">H·ªç v√† T√™n <i class="fa-solid fa-sort"></i></th>
                                    <th onclick="sortTable('mssv')">MSSV <i class="fa-solid fa-sort"></i></th>
                                    <th onclick="sortTable('class_name')">L·ªõp <i class="fa-solid fa-sort"></i></th>
                                    <th style="text-align:center">Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr><td colspan="5" style="text-align:center; padding:30px; color:#999">Vui l√≤ng ch·ªçn ng√†y ƒë·ªÉ xem d·ªØ li·ªáu</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top:10px; font-size:12px; color:#64748b; text-align:right">
                        T·ªïng d√≤ng hi·ªÉn th·ªã: <b id="rowCount">0</b>
                    </div>
                </div>

                <!-- TAB 3: C·∫§U H√åNH -->
                <div id="tab-config" class="tab-content">
                    <div class="form-group">
                        <label>Link Form (form.html):</label>
                        <input type="text" id="cfgLink">
                    </div>
                    <div class="form-group">
                        <label>API Google Apps Script:</label>
                        <input type="text" id="cfgApi">
                    </div>
                    <div style="display:flex; gap:15px">
                        <div class="form-group" style="flex:1">
                            <label>Th·ªùi gian QR (s):</label>
                            <input type="number" id="cfgTime" value="30">
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>M·∫≠t kh·∫©u Admin:</label>
                            <input type="text" id="cfgPass" value="Admin">
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>Pass Reset M√°y:</label>
                            <input type="text" id="cfgResetPass" value="Admin">
                        </div>
                    </div>
                    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                        <button class="btn btn-gray" onclick="closeModal()">H·ªßy</button>
                        <button class="btn btn-primary" onclick="saveConfig()"><i class="fa-solid fa-floppy-disk"></i> L∆∞u C·∫•u H√¨nh</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH M·∫∂C ƒê·ªäNH ---
        const DEFAULT_LINK = "https://nhnanh.github.io/Code_QR_30s_CLB_KHPL/form.html";
        
        let config = {
            link: localStorage.getItem('qr_link') || DEFAULT_LINK,
            api: localStorage.getItem('qr_api') || "",
            time: parseInt(localStorage.getItem('qr_time')) || 30,
            pass: localStorage.getItem('qr_pass') || "Admin",
            resetPass: localStorage.getItem('admin_reset_pass') || "Admin"
        };

        // Bi·∫øn to√†n c·ª•c
        let allData = []; 
        let filteredData = []; 
        let sortState = { key: 'time', dir: 'desc' };
        let timer = config.time;
        let qrObj = null;
        let interval = null;
        
        // Bi·∫øn Chart.js
        let classChartInstance = null;
        let timeChartInstance = null;

        // --- KH·ªûI T·∫†O ---
        window.onload = function() {
            document.getElementById('viewDate').valueAsDate = new Date();
            startSystem();
            setInterval(() => document.getElementById("clock").innerText = new Date().toLocaleString("vi-VN"), 1000);
        };

        function startSystem() {
            if (interval) clearInterval(interval);
            updateQR();
            timer = config.time;
            interval = setInterval(() => {
                timer--;
                document.getElementById("countdown").innerText = timer;
                if (timer <= 0) { timer = config.time; updateQR(); }
            }, 1000);
        }

        function updateQR() {
            const qrDiv = document.getElementById("qrcode");
            const token = Date.now(); 
            const finalLink = `${config.link}?t=${token}`;
            if (qrObj === null) {
                qrDiv.innerHTML = "";
                qrObj = new QRCode(qrDiv, { text: finalLink, width: 250, height: 250, colorDark : "#2563eb" });
            } else {
                qrObj.clear();
                qrObj.makeCode(finalLink);
            }
        }

        // --- ADMIN & MODAL ---
        function checkLogin() {
            const p = prompt("Nh·∫≠p m·∫≠t kh·∫©u Admin:");
            if(p === config.pass) {
                document.getElementById("adminModal").style.display = "flex";
                // Load c·∫•u h√¨nh
                document.getElementById("cfgLink").value = config.link;
                document.getElementById("cfgApi").value = config.api;
                document.getElementById("cfgTime").value = config.time;
                document.getElementById("cfgPass").value = config.pass;
                document.getElementById("cfgResetPass").value = config.resetPass;
                // Load d·ªØ li·ªáu h√¥m nay
                fetchList();
            } else if(p !== null) alert("Sai m·∫≠t kh·∫©u!");
        }

        function closeModal() { document.getElementById("adminModal").style.display = "none"; }
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function saveConfig() {
            config.link = document.getElementById("cfgLink").value;
            config.api = document.getElementById("cfgApi").value;
            config.time = parseInt(document.getElementById("cfgTime").value);
            config.pass = document.getElementById("cfgPass").value;
            config.resetPass = document.getElementById("cfgResetPass").value;
            
            localStorage.setItem('qr_link', config.link);
            localStorage.setItem('qr_api', config.api);
            localStorage.setItem('qr_time', config.time);
            localStorage.setItem('qr_pass', config.pass);
            localStorage.setItem('admin_reset_pass', config.resetPass);
            
            alert("ƒê√£ l∆∞u c·∫•u h√¨nh!");
            closeModal();
            startSystem();
        }

        // --- FETCH D·ªÆ LI·ªÜU ---
        function fetchList() {
            if(!config.api) { alert("Ch∆∞a nh·∫≠p API!"); return; }
            const date = document.getElementById('viewDate').value;
            const loader = document.getElementById('loader');
            
            loader.style.display = "block";

            fetch(`${config.api}?action=GET_LIST&date=${date}`)
            .then(res => res.json())
            .then(res => {
                loader.style.display = "none";
                if(res.status === "success") {
                    allData = res.data;
                    applyFilter(); // T·ª± ƒë·ªông l·ªçc v√† v·∫Ω l·∫°i b·∫£ng + bi·ªÉu ƒë·ªì
                } else {
                    document.getElementById('tableBody').innerHTML = `<tr><td colspan="5" style="text-align:center; padding:20px;">${res.message}</td></tr>`;
                }
            })
            .catch(err => {
                loader.style.display = "none";
                alert("L·ªói k·∫øt n·ªëi API!");
            });
        }

        function applyFilter() {
            const term = document.getElementById("searchInput").value.toLowerCase();
            
            filteredData = allData.filter(item => 
                item.name.toLowerCase().includes(term) || 
                item.mssv.toString().includes(term) || 
                item.class_name.toLowerCase().includes(term)
            );

            runSort();
            renderTable();
            calculateStats();
            renderCharts(); // V·∫º BI·ªÇU ƒê·ªí
        }

        // --- X·ª¨ L√ù B·∫¢NG & S·∫ÆP X·∫æP ---
        function sortTable(key) {
            if (sortState.key === key) {
                sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
            } else {
                sortState.key = key;
                sortState.dir = 'asc';
            }
            updateSortIcons();
            runSort();
            renderTable();
        }

        function updateSortIcons() {
            document.querySelectorAll('th i').forEach(i => i.className = 'fa-solid fa-sort');
            const activeHeader = document.querySelector(`th[onclick="sortTable('${sortState.key}')"] i`);
            if(activeHeader) {
                activeHeader.className = sortState.dir === 'asc' ? 'fa-solid fa-sort-up' : 'fa-solid fa-sort-down';
                activeHeader.style.color = 'var(--primary)';
            }
        }

        function runSort() {
            const { key, dir } = sortState;
            filteredData.sort((a, b) => {
                let valA = a[key].toString().toLowerCase();
                let valB = b[key].toString().toLowerCase();
                if (valA < valB) return dir === 'asc' ? -1 : 1;
                if (valA > valB) return dir === 'asc' ? 1 : -1;
                return 0;
            });
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            document.getElementById('rowCount').innerText = filteredData.length;

            if (filteredData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:30px; font-style:italic">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
                return;
            }

            let html = "";
            filteredData.forEach(item => {
                let timeOnly = item.time.split(" ")[0];
                html += `
                    <tr>
                        <td>${timeOnly}</td>
                        <td style="font-weight:600">${item.name}</td>
                        <td><span style="background:#e2e8f0; padding:2px 6px; border-radius:4px; font-size:12px">${item.mssv}</span></td>
                        <td>${item.class_name}</td>
                        <td style="text-align:center">
                            <button onclick="deleteRow(${item.row_index}, '${item.mssv}', '${item.name}')" 
                                    style="background:none; border:none; color:var(--danger); cursor:pointer" title="X√≥a">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // --- T√çNH TO√ÅN & V·∫º BI·ªÇU ƒê·ªí ---
        function calculateStats() {
            document.getElementById('statTotal').innerText = filteredData.length;
            if(filteredData.length > 0) {
                document.getElementById('statLatest').innerText = filteredData[0].time.split(" ")[0]; 
            } else {
                document.getElementById('statLatest').innerText = "--:--";
            }
        }

        function renderCharts() {
            // 1. Chu·∫©n b·ªã d·ªØ li·ªáu cho L·ªõp (Pie Chart)
            const classCounts = {};
            filteredData.forEach(item => {
                const cls = item.class_name || "Kh√°c";
                classCounts[cls] = (classCounts[cls] || 0) + 1;
            });
            document.getElementById('statClasses').innerText = Object.keys(classCounts).length;

            // 2. Chu·∫©n b·ªã d·ªØ li·ªáu cho Gi·ªù (Bar Chart)
            const hourCounts = {};
            filteredData.forEach(item => {
                const hour = item.time.split(":")[0] + "h"; // L·∫•y gi·ªù (07h, 08h...)
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });
            // S·∫Øp x·∫øp gi·ªù tƒÉng d·∫ßn
            const sortedHours = Object.keys(hourCounts).sort();
            const sortedHourValues = sortedHours.map(h => hourCounts[h]);

            // 3. V·∫Ω Bi·ªÉu ƒë·ªì L·ªõp (Pie)
            const ctxClass = document.getElementById('classChart').getContext('2d');
            if (classChartInstance) classChartInstance.destroy();
            
            classChartInstance = new Chart(ctxClass, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(classCounts),
                    datasets: [{
                        data: Object.values(classCounts),
                        backgroundColor: ['#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'],
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });

            // 4. V·∫Ω Bi·ªÉu ƒë·ªì Gi·ªù (Bar)
            const ctxTime = document.getElementById('timeChart').getContext('2d');
            if (timeChartInstance) timeChartInstance.destroy();

            timeChartInstance = new Chart(ctxTime, {
                type: 'bar',
                data: {
                    labels: sortedHours,
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng',
                        data: sortedHourValues,
                        backgroundColor: '#2563eb',
                        borderRadius: 4
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });
        }

        // --- X√ìA SINH VI√äN ---
        function deleteRow(idx, mssv, name) {
            if(!confirm(`X√≥a sinh vi√™n ${name} (${mssv})?\n\nSinh vi√™n c·∫ßn b·∫•m RESET tr√™n m√°y h·ªç ƒë·ªÉ ƒëi·ªÉm danh l·∫°i.`)) return;
            
            fetch(config.api, {
                method: 'POST',
                body: JSON.stringify({ action: "DELETE_ROW", row_index: idx, mssv: mssv })
            })
            .then(res => res.json())
            .then(res => {
                if(res.status === "success") {
                    alert("ƒê√£ x√≥a!");
                    fetchList(); 
                } else alert("L·ªói: " + res.message);
            })
            .catch(() => alert("ƒê√£ g·ª≠i l·ªánh x√≥a!"));
        }
    </script>
</body>
</html>
