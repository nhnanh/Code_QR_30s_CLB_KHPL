<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Há»† THá»NG ÄIá»‚M DANH QR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-color: #2c3e50; --bg-color: #f4f4f9; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-color); height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; transition: 0.3s; }
        
        /* Cháº¿ Ä‘á»™ tá»‘i */
        body.dark-mode { --main-color: #ecf0f1; --bg-color: #2c3e50; color: white; }
        body.dark-mode .qr-card { background: #34495e; color: white; }
        
        .settings-btn { position: absolute; top: 20px; left: 20px; font-size: 32px; color: #7f8c8d; cursor: pointer; z-index: 10; transition: 0.3s; }
        .settings-btn:hover { transform: rotate(90deg); color: var(--main-color); }

        .qr-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; width: 350px; position: relative; }
        
        #qrcode { display: flex; justify-content: center; margin: 20px 0; border: 10px solid #f0f0f0; border-radius: 10px; padding: 10px; background: white; }
        
        .timer { font-size: 60px; font-weight: 800; color: #e74c3c; line-height: 1; }
        .realtime { font-size: 16px; color: #95a5a6; margin-top: 10px; font-weight: 500; }
        
        /* Modal Admin */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; text-align: left; }
        .modal-header { font-size: 24px; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; color: white; cursor: pointer; margin-top: 5px; }
        .btn-primary { background: #3498db; }
        .btn-danger { background: #e74c3c; }
        .btn-success { background: #2ecc71; }
        
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .feature-item { font-size: 13px; padding: 10px; background: #eee; border-radius: 5px; cursor: pointer; text-align: center; }
        .feature-item:hover { background: #ddd; }
        .feature-item.active { background: #2ecc71; color: white; }

        /* Banner cháº¡y chá»¯ */
        .marquee-container { position: fixed; bottom: 0; width: 100%; background: #e74c3c; color: white; padding: 10px 0; display: none; }
    </style>
</head>
<body>

    <div class="settings-btn" onclick="checkLogin()">âš™ï¸</div>

    <div class="qr-card">
        <h2 id="orgTitle">ÄIá»‚M DANH CLB</h2>
        
        <div id="qrcode"></div>
        
        <div class="timer" id="countdown">--</div>
        <div style="font-size:14px; color:#888;">GiÃ¢y Ä‘á»•i mÃ£</div>
        
        <div class="realtime">
            <i class="far fa-clock"></i> <span id="clock">Loading...</span>
        </div>
    </div>

    <div class="marquee-container" id="marqueeBox">
        <marquee>ğŸ“¢ Há»† THá»NG ÄANG Má» ÄIá»‚M DANH - VUI LÃ’NG QUÃ‰T MÃƒ NHANH CHÃ“NG!</marquee>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">QUáº¢N TRá»Š VIÃŠN <span style="float:right; cursor:pointer" onclick="closeModal()">&times;</span></div>
            
            <div class="input-group">
                <label>Link trang Form (form.html):</label>
                <input type="text" id="cfgLink" placeholder="https://.../form.html">
            </div>
            
            <div class="input-group">
                <label>Thá»i gian Ä‘á»•i QR (giÃ¢y):</label>
                <input type="number" id="cfgTime" value="30">
            </div>

            <div class="input-group">
                <label>Äá»•i máº­t kháº©u Admin:</label>
                <input type="text" id="cfgPass" placeholder="Nháº­p pass má»›i...">
            </div>

            <button class="btn btn-success" onclick="saveSettings()">ğŸ’¾ LÆ¯U CÃ€I Äáº¶T</button>

            <h4 style="margin-bottom: 10px; border-top: 1px solid #ccc; padding-top: 10px;">ğŸš€ TÃNH NÄ‚NG NÃ‚NG CAO</h4>
            <div class="feature-grid">
                <div class="feature-item" onclick="togglePause()" id="btnPause">â¯ï¸ Táº¡m dá»«ng/Tiáº¿p tá»¥c</div>
                <div class="feature-item" onclick="toggleDarkMode()">ğŸŒ™ Cháº¿ Ä‘á»™ tá»‘i/SÃ¡ng</div>
                <div class="feature-item" onclick="changeTitle()">ğŸ“ Äá»•i tiÃªu Ä‘á» CLB</div>
                <div class="feature-item" onclick="toggleMarquee()">ğŸ“¢ Báº­t/Táº¯t dÃ²ng chá»¯ cháº¡y</div>
                <div class="feature-item" onclick="openSheet()">ğŸ“Š Má»Ÿ Sheet dá»¯ liá»‡u</div>
                <div class="feature-item" onclick="resetConfig()">âš ï¸ Reset máº·c Ä‘á»‹nh</div>
                <div class="feature-item" onclick="downloadQR()">â¬‡ï¸ Táº£i áº£nh QR hiá»‡n táº¡i</div>
                <div class="feature-item" onclick="testPing()">ğŸ“¡ Kiá»ƒm tra máº¡ng</div>
                <div class="feature-item" onclick="alert('PhiÃªn báº£n: v2.0 Pro')">â„¹ï¸ ThÃ´ng tin phiÃªn báº£n</div>
                <div class="feature-item btn-danger" onclick="logout()">ğŸšª ÄÄƒng xuáº¥t</div>
            </div>
        </div>
    </div>

    <script>
        // Cáº¤U HÃŒNH BAN Äáº¦U
        let config = {
            link: localStorage.getItem('qr_link') || "",
            time: parseInt(localStorage.getItem('qr_time')) || 30,
            pass: localStorage.getItem('qr_pass') || "Admin",
            title: localStorage.getItem('qr_title') || "ÄIá»‚M DANH CLB",
            isPaused: false,
            darkMode: false
        };

        let timer = config.time;
        let qrObj = null;
        let interval = null;

        // KHá»I CHáº Y
        window.onload = function() {
            document.getElementById("orgTitle").innerText = config.title;
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleString('vi-VN'), 1000);
            
            if(!config.link) {
                alert("ChÃ o Admin! Vui lÃ²ng vÃ o cÃ i Ä‘áº·t nháº­p Link Form Ä‘á»ƒ báº¯t Ä‘áº§u.");
                checkLogin();
            } else {
                startSystem();
            }
        };

        function startSystem() {
            if(interval) clearInterval(interval);
            updateQR();
            timer = config.time;
            
            interval = setInterval(() => {
                if(!config.isPaused) {
                    timer--;
                    document.getElementById('countdown').innerText = timer;
                    if(timer <= 0) {
                        timer = config.time;
                        updateQR();
                    }
                } else {
                    document.getElementById('countdown').innerText = "PAUSE";
                }
            }, 1000);
        }

        function updateQR() {
            const qrDiv = document.getElementById('qrcode');
            // Token lÃ  thá»i gian thá»±c (Ä‘áº£m báº£o khÃ´ng trÃ¹ng)
            const token = Date.now(); 
            const finalUrl = `${config.link}?t=${token}`;

            if(qrObj === null) {
                qrDiv.innerHTML = "";
                qrObj = new QRCode(qrDiv, { text: finalUrl, width: 250, height: 250 });
            } else {
                qrObj.clear();
                qrObj.makeCode(finalUrl);
            }
        }

        // --- Há»† THá»NG ADMIN ---
        function checkLogin() {
            let p = prompt("Nháº­p máº­t kháº©u Admin:");
            if(p === config.pass) {
                document.getElementById('adminModal').style.display = 'flex';
                document.getElementById('cfgLink').value = config.link;
                document.getElementById('cfgTime').value = config.time;
                document.getElementById('cfgPass').value = config.pass;
            } else if (p !== null) {
                alert("Sai máº­t kháº©u!");
            }
        }

        function saveSettings() {
            config.link = document.getElementById('cfgLink').value;
            config.time = parseInt(document.getElementById('cfgTime').value);
            config.pass = document.getElementById('cfgPass').value;
            
            localStorage.setItem('qr_link', config.link);
            localStorage.setItem('qr_time', config.time);
            localStorage.setItem('qr_pass', config.pass);
            
            alert("ÄÃ£ lÆ°u!");
            closeModal();
            startSystem();
        }

        // --- CÃC TÃNH NÄ‚NG NÃ‚NG CAO ---
        function togglePause() {
            config.isPaused = !config.isPaused;
            alert(config.isPaused ? "ÄÃ£ táº¡m dá»«ng!" : "ÄÃ£ tiáº¿p tá»¥c!");
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function changeTitle() {
            let t = prompt("Nháº­p tÃªn tiÃªu Ä‘á» má»›i:", config.title);
            if(t) {
                config.title = t;
                localStorage.setItem('qr_title', t);
                document.getElementById("orgTitle").innerText = t;
            }
        }

        function toggleMarquee() {
            let m = document.getElementById("marqueeBox");
            m.style.display = m.style.display === "none" ? "block" : "none";
        }

        function openSheet() {
            let url = prompt("Nháº­p link Google Sheet cá»§a báº¡n Ä‘á»ƒ má»Ÿ nhanh:");
            if(url) window.open(url, '_blank');
        }

        function downloadQR() {
            let img = document.querySelector("#qrcode img");
            if(img) {
                let link = document.createElement('a');
                link.download = 'QR_DiemDanh.png';
                link.href = img.src;
                link.click();
            }
        }
        
        function testPing() { alert(navigator.onLine ? "âœ… Máº¡ng á»•n Ä‘á»‹nh" : "âŒ Máº¥t káº¿t ná»‘i máº¡ng"); }
        function resetConfig() { if(confirm("XÃ³a toÃ n bá»™ cÃ i Ä‘áº·t?")) { localStorage.clear(); location.reload(); } }
        function logout() { closeModal(); }
        function closeModal() { document.getElementById('adminModal').style.display = 'none'; }
    </script>
</body>
</html>
