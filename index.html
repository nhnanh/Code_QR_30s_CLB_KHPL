<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG ƒêI·ªÇM DANH QR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS G·ªçn g√†ng */
        :root { --primary: #2563eb; --bg: #f1f5f9; --text: #1e293b; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .settings-btn { position: absolute; top: 20px; left: 20px; font-size: 28px; color: #64748b; cursor: pointer; padding: 10px; }
        .settings-btn:hover { color: var(--primary); transform: rotate(90deg); transition: 0.4s; }

        .qr-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 380px; }
        #qrcode { background: white; padding: 15px; border: 2px dashed #cbd5e1; border-radius: 16px; display: inline-block; margin: 20px 0; }
        
        .timer { font-size: 64px; font-weight: 900; color: #ef4444; line-height: 1; }
        .realtime { margin-top: 20px; font-weight: 600; color: #64748b; border-top: 1px solid #eee; padding-top: 15px;}

        /* Modal Admin */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 450px; border-radius: 20px; padding: 30px; }
        input { width: 100%; padding: 12px; margin: 5px 0 15px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box;}
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="settings-btn" onclick="checkLogin()"><i class="fa-solid fa-gear"></i></div>

    <div class="qr-card">
        <h1 id="orgName">ƒêI·ªÇM DANH CLB</h1>
        <div id="qrcode"></div>
        
        <div class="timer" id="countdown">--</div>
        <div style="font-size:14px; color:#64748b;">L√†m m·ªõi sau (gi√¢y)</div>
        
        <div class="realtime"><i class="fa-regular fa-clock"></i> <span id="clock">Loading...</span></div>
    </div>

    <!-- MODAL ADMIN -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0">‚öôÔ∏è C√†i ƒê·∫∑t Admin</h2>
            <label>Link trang Form:</label>
            <input type="text" id="cfgLink" value="https://nhnanh.github.io/Code_QR_30s_CLB_KHPL/form.html">
            
            <label>Th·ªùi gian ƒë·ªïi (s):</label>
            <input type="number" id="cfgTime" value="30">
            
            <label>M·∫≠t kh·∫©u Admin:</label>
            <input type="text" id="cfgPass" value="Admin">

            <button onclick="saveConfig()">üíæ L∆ØU C√ÄI ƒê·∫∂T</button>
            <button onclick="closeModal()" style="background:#64748b; margin-top:10px">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // C·∫§U H√åNH M·∫∂C ƒê·ªäNH
        const DEFAULT_LINK = "https://nhnanh.github.io/Code_QR_30s_CLB_KHPL/form.html";
        
        let config = {
            link: localStorage.getItem('qr_link') || DEFAULT_LINK,
            time: parseInt(localStorage.getItem('qr_time')) || 30,
            pass: localStorage.getItem('qr_pass') || "Admin"
        };

        let timer = config.time;
        let qrObj = null;
        let interval = null;

        window.onload = function() {
            startSystem();
            setInterval(() => document.getElementById("clock").innerText = new Date().toLocaleString("vi-VN"), 1000);
        };

        function startSystem() {
            if (interval) clearInterval(interval);
            updateQR();
            timer = config.time;
            
            interval = setInterval(() => {
                timer--;
                document.getElementById("countdown").innerText = timer;
                if (timer <= 0) {
                    timer = config.time;
                    updateQR();
                }
            }, 1000);
        }

        function updateQR() {
            const qrDiv = document.getElementById("qrcode");
            // Token th·ªùi gian th·ª±c ƒë·ªÉ check h·∫øt h·∫°n
            const token = Date.now(); 
            const finalLink = `${config.link}?t=${token}`;

            if (qrObj === null) {
                qrDiv.innerHTML = "";
                qrObj = new QRCode(qrDiv, { text: finalLink, width: 250, height: 250 });
            } else {
                qrObj.clear();
                qrObj.makeCode(finalLink);
            }
        }

        // Admin Functions
        function checkLogin() {
            const p = prompt("Nh·∫≠p m·∫≠t kh·∫©u:");
            if(p === config.pass) openModal();
            else if(p !== null) alert("Sai m·∫≠t kh·∫©u!");
        }
        function openModal() {
            document.getElementById("adminModal").style.display = "flex";
            document.getElementById("cfgLink").value = config.link;
            document.getElementById("cfgTime").value = config.time;
            document.getElementById("cfgPass").value = config.pass;
        }
        function closeModal() { document.getElementById("adminModal").style.display = "none"; }
        
        function saveConfig() {
            config.link = document.getElementById("cfgLink").value;
            config.time = parseInt(document.getElementById("cfgTime").value);
            config.pass = document.getElementById("cfgPass").value;
            
            localStorage.setItem('qr_link', config.link);
            localStorage.setItem('qr_time', config.time);
            localStorage.setItem('qr_pass', config.pass);
            
            alert("ƒê√£ l∆∞u!");
            closeModal();
            startSystem();
        }
    </script>
</body>
</html>
